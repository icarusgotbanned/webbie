<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Absolute Assistant â€” Success</title>
  <meta name="theme-color" content="#0b1220" />
  <style>
    :root{--bg:#0b1220;--panel:#111a2b;--text:#e8eef8;--muted:#aab7cf;--bd:rgba(255,255,255,.08);--a1:#7dd3fc;--a2:#34d399}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:760px;margin:0 auto;padding:44px 20px}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:14px}
    .logo{width:24px;height:24px;border-radius:8px;background:linear-gradient(135deg,var(--a1),var(--a2))}
    h1{margin:8px 0 12px}
    .card{background:var(--panel);border:1px solid var(--bd);border-radius:12px;padding:16px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;margin-top:10px}
    .btn{background:linear-gradient(90deg,var(--a1),var(--a2));color:#0b1220;border:none;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer}
    code,pre{font-family:ui-monospace,Consolas,Menlo,monospace}
    pre{white-space:pre-wrap;word-break:break-word}
    a{color:inherit}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <strong>Absolute Assistant</strong>
    </div>
    <h1>Thanks â€” your subscription is active ðŸŽ‰</h1>
    <p class="muted">Hereâ€™s your license key. Keep it somewhere safe.</p>

    <div id="box" class="card" style="margin:14px 0">
      <div id="status">Retrieving your licenseâ€¦</div>
      <pre id="key" style="margin:10px 0 0"></pre>
      <div class="row">
        <button id="copy" class="btn" style="display:none">Copy</button>
        <a class="btn" href="/">Back to site</a>
      </div>
    </div>

    <p class="muted">If the key doesnâ€™t appear, refresh this page in a few seconds.</p>
  </div>

  <script>
  (async () => {
    const sp = new URLSearchParams(location.search);
    const id = sp.get("session_id");
    const status = document.getElementById("status");
    const keyEl = document.getElementById("key");
    const copy = document.getElementById("copy");
    if(!id){ status.textContent="Missing session id."; return; }
    try{
      const r = await fetch(`/api/lookup-license?session_id=${encodeURIComponent(id)}`);
      const d = await r.json();
      if(d.license_key){
        status.textContent = "Your license key:";
        keyEl.textContent = d.license_key;
        copy.style.display = "inline-block";
        copy.onclick = async () => {
          try{ await navigator.clipboard.writeText(d.license_key); copy.textContent="Copied!"; }
          catch{ copy.textContent="Copy failed"; }
        };
      }else{
        status.textContent = "License not ready yet. Try refreshing shortly.";
      }
    }catch(e){
      status.textContent = "Error loading license.";
    }
  })();
  </script>
</body>
</html>
